# Notes on building the Windows port using Mingw, if you're not me, and
# not trying to build the Windows port and dependencies from source, you
# can safely ignore this file

Create Windows VM (with at least 4 cores, 8GB of memory, and 100GB of disk,
    because Windows is insanely bloated)
Install MSYS2

pacman -Sy
pacman -Su

# Done on separate lines because there is a solid chance of any
# random pacman run failing

# TODO:  Equivalent to yum/dnf -y switch?

# UPDATE: most of these are available from pacman

pacman -S base-devel
pacman -S mingw-w64  # is this really needed?
pacman -S mingw-w64-x86_64-toolchain
pacman -S mingw-w64-i686-toolchain
pacman -S libraries
pacman -S git
pacman -S python   # this is python3
git clone https://github.com/Alexpux/MINGW-packages.git

# Dependencies:
pyqt5
numpy
fftw
libsndfile
portaudio
portmidi (from where?  Or should I allow building without MIDI support?
    Or http://stackoverflow.com/questions/18156694/trying-to-build-a-portmidi-example-in-mingw)
libvorbis


for dependency in dependencies:
  cd dependency
  makepkg-mingw -Cfs
  cd ..

# Pacman and makepkg both break all the fucking time for no reason,
# however, they're still better than Visual Studio

# UNTESTED:
# packages all install to /mingw32 and /mingw64 , so generate stripped
# down versions of those directories for packaging with NSIS?
# TODO:  Are the directories relocatable?
# TODO:  PKGBUILD for MusiKernel?

# TODO:  Set package root?
pacman -Syr /musikernel1 {packages}

# Building MusiKernel

export PATH="/mingw64/bin:$PATH"
CC=/mingw64/bin/gcc /mingw64/bin/mingw32-make

export PATH="/mingw32/bin:$PATH"
CC=/mingw32/bin/gcc /mingw32/bin/mingw32-make


# The "it's almost running now" notes section:

Compiling:
skip deps builds and just know that functionality is missing right now
FFS add my own Rubberband binary manually for now

cd pydaw_render
CC=/mingw64/bin/gcc.exe  /mingw64/bin/mingw32-make.exe

# For some reason, specifying the variables isn't working, so I just edited
# that shit manually for now
cd pydaw
PORTMIDI_FLAG= PLAT_LINK_CLFAGS= CC=/mingw64/bin/gcc.exe  /mingw64/bin/mingw32-make.exe lib

#install
make DESTDIR=/mingw64 PREFIX= install_mingw


