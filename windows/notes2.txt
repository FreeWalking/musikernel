# Notes on building the Windows port using Mingw, if you're not me, and
# not trying to develop or compile the Windows port and dependencies 
# from source, you can safely ignore this file

Create Windows VM (with at least 4 cores, 8GB of memory, and 100GB of disk,
    because Windows is insanely bloated)

Install Netbeans
  - Tools -> Plugins -> C/C++
  - Tools -> Options -> C/C++ -> Add C:\msys2\mingw64\bin
                     -> Editor -> On Save -> All Lang. -> Trim Whitespace

Install Anaconda (Spyder)
  - Tools -> Preferences (trim whitespace, change theme)

Install MSYS2

pacman -Sy
pacman -Su

# Done on separate lines because there is a solid chance of any
# random pacman run failing

# TODO:  Equivalent to yum/dnf -y switch?

# UPDATE: most of these are available from pacman

pacman -S base-devel
pacman -S mingw-w64  # is this really needed?
pacman -S mingw-w64-x86_64-toolchain
pacman -S mingw-w64-i686-toolchain
pacman -S libraries
pacman -S git
pacman -S python   # this is python3
git clone https://github.com/Alexpux/MINGW-packages.git

# UPDATE:  Some (all?) of these are now available from pacman
# Dependencies:
pyqt5
numpy
fftw
libsndfile
portaudio
portmidi
rubberband
libvorbis

for dependency in dependencies:
  cd dependency
  makepkg-mingw -Cfs
  cd ..

# Pacman and makepkg both break all the fucking time for no reason,
# however, they're still better than Visual Studio

# UNTESTED:
# packages all install to /mingw32 and /mingw64 , so generate stripped
# down versions of those directories for packaging with NSIS?
# TODO:  Are the directories relocatable?
# TODO:  PKGBUILD for MusiKernel?

# TODO:  Set package root?
pacman -Syr /musikernel1 {packages}

# Building MusiKernel

export PATH="/mingw64/bin:$PATH"
CC=/mingw64/bin/gcc /mingw64/bin/mingw32-make

export PATH="/mingw32/bin:$PATH"
CC=/mingw32/bin/gcc /mingw32/bin/mingw32-make


# The "it's almost running now" notes section:

cd pydaw_render
CC=/mingw64/bin/gcc.exe  /mingw64/bin/mingw32-make.exe

# For some reason, specifying the variables isn't working, so I just edited
# that shit manually for now
cd pydaw
PLAT_LINK_CLFAGS= CC=/mingw64/bin/gcc.exe  /mingw64/bin/mingw32-make.exe lib

#install
make PREFIX= DESTDIR=/mingw64 install_mingw



#### PACKAGING NOTES ####

(speculative, none of this is proven yet)

Download the MSYS2 base portable tar.xz and unpack

Generate packages from a MusiKernel PKGBUILD and install using:

# switch for installing dependencies?
pacman -U mingw-blah-musikernel.tar.xz

Make 2 copies of the folder, one with only 64 bit and one with only 32 bit

NSIS, or just zip?  (NSIS can use LZMA and make much smaller distributables)

UPDATE:  It only works if it's in the exact same path it was created in,
if there's a way to re-link everything, I have not found it yet.


